{% extends 'template.html' %}
    	
{% block title %}Follower side{% endblock title %}

{% block head %}
{% block style %}

<link href="../static/follower_side.css" rel="stylesheet">
<link href="../static/page_top.css" rel="stylesheet">

<link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/start/jquery-ui.css" rel="stylesheet" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>

<!-- js file -->
<script type="text/javascript" src="../static/splitscreen.js" ></script>

{% endblock style %}

<script>
(function(s,u,r,f,l,y){s[f]=s[f]||{init:function(){s[f].q=arguments}};
l=u.createElement(r);y=u.getElementsByTagName(r)[0];l.async=1;
l.src='https://surfly.com/surfly.js';y.parentNode.insertBefore(l,y);})
(window,document,'script','Surfly');
</script>

<script>
var sess;
var settings = {widgetkey:'b84defc4621441ecae5eb10bdec1cb5a', block_until_agent_joins: false, ui_off: true, set_to_smallest: false};
window.addEventListener('DOMContentLoaded', function() {
  Surfly.init(settings, function(init) {
    if (init.success) {
	if(!Surfly.currentSession){
	    	s = Surfly.session();
	        s._settings.url = "https://www.duckduckgo.com";
		s.on('session_started', function(session) {
                        // get the follower link
			var retrievedLink = session.followerLink;
			var frame = document.getElementById('ifrm2').contentWindow;
			// send link to frame
			frame.postMessage(JSON.stringify({"command": "message", "data": retrievedLink}), '*');
			// make the nav bar visible
			document.getElementById('form_wrapper').style.visibility = "visible";
			// make menu elements visible
			document.getElementById('menu').style.visibility = "visible";
			// store session
			sess = session;
	     	})
		.on('relocated', function(session, event) {
			var frame = document.getElementById('ifrm1').contentWindow;
			frame.postMessage(JSON.stringify({"command": "message", "data": "The follower relocated to: " + event.url }), '*');
		})
		.on('viewer_joined', function(session, event) {
			update_feed("Someone joined your session!");
		})
		.on('session_ended', function(session) {
			document.getElementById('exit_button').style.visibility="hidden";
		}).startLeader('#ifrm1'); 
	}
    }
   });
 });
</script>

{% endblock head %}

{% block content %}

{% block menu %}

  {{ super() }}

{% endblock menu %}


<script>
// get the current url and the follower link
pageUrl  = document.location.href;
var idIndex = pageUrl.indexOf(".com");
var sessionID = pageUrl.substring(idIndex+4);
var fullUrl =  "https://surfly.com".concat(sessionID);
// set the url of the first frame to the follower link
document.getElementById('ifrm2').src = fullUrl;
</script>

<!-- define form behaviour -->
<script type="text/javascript" src="../static/form.js" ></script>

{% endblock content %}
